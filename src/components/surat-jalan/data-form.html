<template>
    <require from="utils/date-format"></require>
    <require from="customs/elements/horsey"></require>
    <form class="form-horizontal">
        <div class="form-group ${error.SJNo?'has-error':''}">
            <label for="SJNo" class="col-sm-2 control-label">Nomor Surat Jalan</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="SJNo" value.bind="data.SJNo" />
                <span class="help-block">${error.SJNo}</span>
            </div>
        </div>
        <div class="form-group ${error.SJDate?'has-error':''}">
            <label for="SJDate" class="col-sm-2 control-label">Tanggal Surat Jalan</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="SJDate" value.bind="data.SJDate"></input>
                <span class="help-block">${error.SJDate}</span>
            </div>
        </div>
        <div class="form-group ${error.productArriveDate?'has-error':''}">
            <label for="productArriveDate" class="col-sm-2 control-label">Tanggal Datang Barang</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="productArriveDate" value.bind="data.productArriveDate"></input>
                <span class="help-block">${error.productArriveDate}</span>
            </div>
        </div>
        <div class="form-group ${error.supplier?'has-error':''}">
            <label class="col-sm-2 control-label">Kode Supplier</label>
            <div class="col-sm-3">
                <horsey src.bind="uriSupplier" selection.bind="data.supplier" options.bind="{label:'labelSupplier', value:'_id'}" map.bind="mapSupplier"></horsey>
                <span class="help-block">${error.supplier}</span>
            </div>
        </div>
        <div class="${data.supplier._id ? '' : 'hide'} form-group">
            <label class="col-sm-2 control-label">Nama Supplier</label>
            <div class="col-sm-5">
                <p class="form-control-static">${data.supplier.name}</p>
            </div>
         </div>
         <div class="form-group ${error.deliveryType?'has-error':''}">
            <label class="col-sm-2 control-label">Jenis Pengiriman</label>
            <div class="col-sm-3">
                <select value.bind="data.deliveryType">
                    <option>Pilih Jenis Pengiriman</option>
                    <option>Lokal</option>
                    <option>AWB</option>
                    <option>BL</option>                    
                </select>
                <span class="help-block">${error.deliveryType}</span>
            </div>
        </div>
        <div class="${data.deliveryType == 'Lokal' ? 'hide' : ''} form-group ${error.deliveryNo?'has-error':''}">
            <label for="deliveryNo" class="col-sm-2 control-label">Nomor Pengiriman</label>
            <div class="col-sm-3">
                <input type="text" class="form-control" name="deliveryNo" value.bind="data.deliveryNo"></input>
                <span class="help-block">${error.deliveryNo}</span>
            </div>
        </div>
        <div class="${data.supplier._id ? '' : 'hide'} form-group ${error.po?'has-error':''}">
            <span class="help-block">${error.items}</span>
            <h4>List Po</h4>
            <div  class="col-sm-10">
                <table class="table table-striped table-hover">
                    <tr>
                        <th>Nomor PO</th>
                        <th>Nomor PR</th>
                        <th>Nomor RO</th>
                        <th>Artikel</th>
                        <th>Konfeksi</th>
                        <th>Mata Uang</th>
                        <th>Tanggal Jatuh Tempo</th>
                        <th>Barang</th>
                        <th><button class="btn pull-right btn-success" click.delegate="addPO()">Tambah PO</button></th>
                     </tr>
                    <template repeat.for="item of data.items">
                    <tr style='padding-top:20px; padding-bottom:20px;'>
                        <td class="rTableCell" style='width: 170px;'> <horsey src.bind="uri" selection.bind="item" options.bind="{label:'PONo', value:'_id'}" change.delegate="horseyChanged($index,$event)" map.bind="map"></horsey> </td>
                        <td class="rTableCell">${item.PRNo}</td>
                        <td class="rTableCell">${item.RONo}</td>
                        <td class="rTableCell">${item.article}</td>
                        <td class="rTableCell">${item.RONo ? setKonfeksi(item.RONo) : ''}</td>
                        <td class="rTableCell">${item.currency}</td>
                        <td class="rTableCell">${item.paymentDue}</td>
                        <td class="rTableCell"> <button class="${item.PRNo? '' : 'hide'}  btn btn-primary" click.delegate="showDetail(item)">Rincian Barang</button> </td>
                        <td class="rTableCell"> <button class="${item.PRNo? '' : 'hide'}  btn pull-right btn-danger" click.delegate="removePO(item)">Hapus PO</button> </td>
                     </tr>
                     <tr if.bind="item.showDetails">
                         <td></td>
                         <td colspan="8">
                             <table style='padding-top: 10px; padding-bottom:10px; border: 1px solid gray;' class="table">
                                <thead>
                                    <tr> <td align="center"colspan="8"><b>Rincian Barang</b></td> </tr>
                                    <tr>
                                        <th>Kode Barang</th>
                                        <th>Nama Barang</th>
                                        <th>Keterangan</th>
                                        <th>Satuan</th>
                                        <th>Jumlah Barang di PO</th>
                                        <th>Jumlah Barang di SJ</th>
                                        <th>Harga</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr repeat.for="poItem of item.items">
                                        <td>${poItem.product.code}</td>
                                        <td>${poItem.product.name}</td>
                                        <td>${poItem.product.description}</td>
                                        <td>${poItem.product.UoM ? poItem.product.UoM.unit : ''}</td>
                                        <td>${poItem.dealQuantity}</td>
                                        <td>
                                            <input style='width: 100px;' type="number" class="form-control ${error.poItem?'has-error':''}" name="realizationQuantity" min="1" value.bind="poItem.realizationQuantity"></input>
                                            <span class="help-block">${error.poItem}</span>
                                        </td>
                                        <td>${poItem.price}</td>
                                        <td><button class="btn pull-right btn-danger" click.delegate="removeProduct(item,poItem)">Hapus Barang</button></td> 
                                    </tr>
                                </tbody>
                             </table>
                        </td>
                     </tr>
                    </template>
                 </table>
            </div>
        </div>
    </form>
</template>